"use strict";function ShotCtrl(t,e,o,i,n,r,a,s,l,c,u,d){function h(){var t=document.querySelector(".intro-splash");t.style.opacity=0,i(function(){t.nextElementSibling.style.opacity=1},1e3)}var v=this;this.id=a.current,this.next=a.getNext(),this.previous=a.getPrevious(),this.videoUrl=a.getVideoUrl(),this.shots=[],this.volumes=[],this.currentVolume=null,this.thumbsForTag={},u.pageview(window.location.href,document.title+" - Shot "+this.id),t.menuIsOn=!1,t.showMenuTab="shots",angular.element(document.body).removeClass("noscroll");var p=3e4;this.played=!1,this.play=function(){v.played=!0,v.backgroundOpacity=0,v.playing=!0,l.play(function(){v.stop(),d.autoScroll()})},this.stop=function(){v.playing=!1,l.resumeLoop(),v.backgroundOpacity=1,t.$apply()};var m=!0;this.id&&a.getShot(this.id).then(function(e){window.location.search.indexOf("installation")>=0&&i(function(){v.played||v.play()},p);var o=[{type:"introduction",shot:v.id,title:e[0].title,authors:e[0].author.name,nav:"introduction",attributes:{loop:e[0].timecodes},onEnter:function(){t.inView=!0,v.ready||i(function(){v.ready=!0,h()},3e3),t.$apply()},onExit:function(){t.inView=!1,v.stop()}}],r=[{shot:v.id,type:"outro",next:v.next,onEnter:function(){window.location.search.indexOf("installation")>=0&&i(function(){m&&(c.scrollToSlide(v.slides[0]),n.go("shot",{shot:v.next||1}))},p)},onExit:function(){m=!1}}],a=o.concat(s.parse(e),r);v.annotations=e,v.slides=a,_.each(a,function(e){e.isNav=t.isNavSlide(e),e.isHeader=t.isHeaderSlide(e),i(function(){e.volume=v.currentVolume},300)})}),a.getThumbnails(0).then(function(e){t.thumbs=v.thumbs=e;var o=_.findIndex(e,function(t){return parseInt(t.slug,10)===v.id}),n=275,r=n*Math.floor(o/2);i(function(){document.querySelector(".nav-menu-shots").scrollTop=r},300)}),a.getVolumes().then(function(e){t.volumes=e,_.each(e,function(e){e.slug===r.volume&&(t.currentVolume=v.currentVolume=e)})}),a.getVolumeShots().then(function(e){t.shots=e}),a.getTags(0).then(function(t){v.tags=_.map(_.sortBy(t,function(t){return-t.post_count}).slice(0,30),function(t){return t.title=t.title.replace(/\s/g,"&nbsp;"),t})}),t.isHeaderSlide=function(t){var e=["introduction","text","column","outro","author","photo","video","streetview","bg-video"];return _.contains(e,t.type)},t.isNavSlide=function(t){var e=["introduction","text","column","author","photo","video","streetview","main-title"];return _.contains(e,t.type)},t.scrollToSlide=function(t){c.scrollToSlide(t)},t.thumbnailForShot=function(t){return"/wp/wp-content/uploads/Shots_400px/"+t.slug+".png"},t.annotationsForShot=function(t){a.getShot(Number(t.slug)).then(function(){})},t.toggleMenu=function(){t.menuIsOn?(l.resumeLoop(),angular.element(document.body).removeClass("noscroll")):(l.pause(),angular.element(document.body).addClass("noscroll")),t.menuIsOn=!t.menuIsOn},t.toggleGlobalMenu=function(){t.globalIsOn?(l.resumeLoop(),angular.element(document.body).removeClass("noscroll")):(l.pause(),angular.element(document.body).addClass("noscroll")),t.globalIsOn=!t.globalIsOn},t.filterShots=function(e){e?v.thumbsForTag[e.id]?t.thumbs=v.thumbsForTag[e.id]:a.getAnnotationsForTag(e,0).then(function(o){var i={};_.each(o,function(t){t.categories.length&&(i[t.categories[0].id]=t.categories[0])}),t.thumbs=v.thumbsForTag[e.id]=_.toArray(i)}):t.thumbs=v.thumbs},t.getArticleNumber=function(t){return ShotFilter(t)}}function ShotService(t,e,o,i,n,r){var a=this,s=parseInt(i.shot,10),l=parseInt(i.volume,10);document.title=document.title+" - Vol "+romanize(l),this.current=isNaN(s)?0:s,this.currentVolumeIndex=isNaN(l)?0:l,this.getVideoUrl=function(){var t=o("shot")(this.currentVolumeIndex)+"-"+o("shot")(this.current),e="https://s3.amazonaws.com/world-records-journal/"+t+".mp4";return e};var c=100;this.getNext=function(){var t=this.current+1;return c>=t?o("shot")(t):null},this.getPrevious=function(){var t=this.current-1;return t>=0?o("shot")(t):null},this.cache=[];var u="/wp/?json=get_post&post_type=mm_annotation&slug=";this.getShot=function(t){var i=n.defer(),s="number"!=typeof t||isNaN(t)?this.current:t;if(s=o("shot")(this.currentVolumeIndex)+"-"+o("shot")(s),this.cache[s])return i.resolve(this.cache[s]),i.promise;var l=u+s;return e({method:"GET",url:l}).success(function(t){a.cache[s]=r.parse(t.post),i.resolve(a.cache[s])}).error(function(){i.reject("Error fetching shot "+s)}),i.promise};var d={};this.getVolumes=function(){var t=n.defer();return e({method:"GET",url:"/wp/?json=get_category_index"}).success(function(e){if("ok"===e.status){var o=[];e.categories.forEach(function(t){2===t.slug.length&&(o.push(t),d[parseInt(t.slug,10)]=t.post_count)}),c=d[l],t.resolve(o)}else t.reject("Error fetching volumes")}).error(function(){t.reject("Error fetching volumes")}),t.promise},this.getVolumeShots=function(){var t=n.defer();return e({method:"GET",url:"/wp/?json=get_category_posts&category_slug="+i.volume}).success(function(e){"ok"===e.status?(e.posts.forEach(function(t){var e=t.slug.split("-");e.length>1&&(t.volume=e[0],t.index=e[1],t.annotations=r.parse(t))}),t.resolve(e.posts)):t.reject("Error fetching volumes")}).error(function(){t.reject("Error fetching volumes")}),t.promise};var h="/wp/?json=get_category_index";this.getThumbnails=function(t){var o=n.defer();return t=t||0,e({method:"GET",url:h+"&page="+t}).success(function(t){"ok"===t.status?o.resolve(t.categories):o.reject("Error fetching shots")}).error(function(){o.reject("Error fetching shots")}),o.promise};var v="/wp/?json=get_tag_posts";this.getAnnotationsForTag=function(t,o){var i=n.defer();return o=o||0,e({method:"GET",url:v+"&id="+t.id+"&page="+o}).success(function(t){"ok"===t.status?i.resolve(t.posts):i.reject("Error fetching shots")}).error(function(){i.reject("Error fetching shots")}),i.promise};var p="/wp/?json=get_tag_index";this.getTags=function(t){var o=n.defer();return t=t||0,e({method:"GET",url:p+"&page="+t}).success(function(t){"ok"===t.status?o.resolve(t.tags):o.reject("Error fetching shots")}).error(function(){o.reject("Error fetching shots")}),o.promise},t.$on("$stateChangeStart",function(t,e,o){var i=parseInt(o.volume,10);isNaN(i)||(a.currentVolumeIndex=i,c=d[i]);var n=parseInt(o.shot,10);!isNaN(n)&&n>=0&&c>=n&&(a.current=n)})}function romanize(t){if(!+t)return 0/0;for(var e=String(+t).split(""),o=["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM","","X","XX","XXX","XL","L","LX","LXX","LXXX","XC","","I","II","III","IV","V","VI","VII","VIII","IX"],i="",n=3;n--;)i=(o[+e.pop()+10*n]||"")+i;return Array(+e.join("")+1).join("M")+i}function AnnotationsService(t){this.parse=function(e){return[new t(e)]}}function AnnotationParserService(t,e){this.parse=function(o){var i=[];return angular.forEach(o,function(o){var n=o.content,r=/({\d+})/g,a='<a class="footnote">$1</a>';n=n.replace(r,a);var s=n.split(/\[slide\s*/gi);return s.length<2?(i.push({type:"text",content:n,attributes:{text:void 0},annotation:o}),!1):(s=s.slice(1),angular.forEach(s,function(r){var a=r.split("]");if(a.length<2)throw new Error('Slide tag "'+a[0]+'" did not have closing bracket: '+n);var s=a[0],l=a[1],c=/(\w+)(?=$|\s|=)/i,u=c.exec(s);if(null===u)throw new Error("Could not determine type of slide tag: "+r);u=u[1].toLowerCase();var d={text:1,column:1,background:1,photo:1,highlight:1,audio:1,video:1,streetview:1};if(!d[u])throw new Error("Type not allowed: "+u);var h={};s=s.replace(/&#8220;|&#8221;|&#8243;/g,'"'),s=s.replace(/&#8216;|&#8217;|&#8242;/g,"'"),s=s.replace(/&#8211;|&#8212;/g,"-");for(var v,p,m,g=/(\w+)=("[^"]*"|'[^']*'|\w+)/g,f=s;null!==(v=g.exec(s));)p=v[1].toLowerCase(),m=v[2],('"'===m.charAt(0)||"'"===m.charAt(0))&&(m=m.slice(1,-1)),"video"===p&&(m=m.split(",")),h[p]=m,f=f.replace(v[0],"");angular.forEach(f.split(/\s+/g),function(t){t&&(h[t]=void 0)}),h.caption&&(h.caption=h.caption.replace(/\<br\s*\/*\>/gi,"")),("photo"===u||"background"===u||"video"===u)&&(l=l.replace(/\<br\s*\/*\>/gi,""),"video"===u&&(l=l.replace(/width\=\"[0-9a-z]+\"/gi,""),l=l.replace(/height\=\"[0-9a-z]+\"/gi,"")));var y={type:u,content:t.trustAsHtml(l),attributes:h,annotation:o},b={photo:"photos",video:"video",streetview:"Then & Now"};y.nav=h.title||b[u],"video"===u&&(y.onEnter=function(){e.$broadcast("videoEnter",y)},y.onExit=function(){e.$broadcast("videoExit",y)}),i.push(y)}),void 0)}),i}}function Annotation(){function t(t){function e(t){var e=o&&o[t]&&o[t][0];return e||""}if(t){this.slug=t.categories[0].slug,this.title=t.title,this.content=t.content||"",this.author=t.custom_fields.authors?{name:t.custom_fields.authors[0],description:t.custom_fields.description[0],image:"/wp/wp-content/uploads/authors/"+t.author.nickname+".jpg"}:{name:t.author&&t.author.name,description:t.author.description,image:"/wp/wp-content/uploads/authors/"+t.author.nickname+".jpg"};var o=t.custom_fields,i=e("mm_annotation_streetview"),n=e("mm_annotation_start_timecode"),r=e("mm_annotation_end_timecode"),a=e("mm_annotation_x"),s=e("mm_annotation_y");i&&(this.streetView=i),(n||r)&&(this.timecodes={start:n&&parseFloat(n)||0,end:r&&parseFloat(r)||0}),(a||s)&&(this.highlight={x:a&&parseFloat(a)||0,y:s&&parseFloat(s)||0});var l={};t.tags&&t.tags.length&&angular.forEach(t.tags,function(t){l[t.title]=1}),this.tags=l}}return t}function StreetViewService(){var t="//maps.googleapis.com/maps/api/streetview?",e="AIzaSyCru1EQFOIRQgaalFfc7TtJH0S6TosODQ4",o=e?"https:":"";this.parseStreetViewUrl=function(t,e){var o={size:e||"200x200",sensor:"false"},i=/www\.google\.com\/maps.*\/@([^\/]+)\//,n=i.exec(t);return n?(n=n[1].split(","),o.location=n[0]+","+n[1],o.fov=parseInt(n[3].replace("y",""),10),o.heading=parseFloat(n[4].replace("h","")),o.pitch=parseFloat(n[5].replace("t",""))-90,o):!1},this.buildStreetViewAPIUrl=function(i){var n=[];for(var r in i)n.push(r+"="+i[r]);return e&&n.push("key="+e),o+t+n.join("&")}}function VideoService(t){var e=document.createElement("canvas"),o=e.getContext("2d"),i=[],n=[];this.screenshotTaken=function(e){e=e||0;var o=t.current,n=i[o];return n&&n[e]};var r=function(t){var i=t.videoHeight,n=t.videoWidth;return e.height=i,e.width=n,o.drawImage(t,0,0),o.getImageData(0,0,n,i)};this.screenshot=function(e,o){var a=t.current,s=!i[a],l=i[a]||{};l[o]=r(e),i[a]=l;var c=n[a],u=c&&c[o];if(u&&u.length){for(;u.length;)u.pop()(l[o]);n[a][o]=null}s&&c&&_.forIn(c,function(t){_.forEach(t,function(t){t(l[o])})})},this.requestScreenshot=function(e,o){var r=t.current,a=i[r]||{};a[e]?o(a[e]):(n[r]=n[r]||{},n[r][e]=n[r][e]||[],n[r][e].push(o),a[0]?o(a[0]):_.forIn(a,function(t){return o(t),!1}))}}function ShotVideoService(){var t=this,e={start:0,end:0},o=e,i=!1,n=null;this.registerShotVideo=function(i){t.video&&t.video.removeEventListener("timeupdate",t.onTimeUpdate,!1),t.video=i,o=e,t.video.addEventListener("timeupdate",t.onTimeUpdate,!1)},this.play=function(e){t.video.readyState<2||(i=!0,n=e,t.video.currentTime=0,t.video.playbackRate=1,t.video.muted=!1,t.video.loop=!1,e&&t.video.addEventListener("ended",n,!1))},this.resumeLoop=function(){t.video.readyState<2||(i=!1,t.video.playbackRate=.3,t.video.muted=!0,t.video.loop=!0,t.video.removeEventListener("ended",n,!1),n=null,t.video.currentTime=0,t.video.play())},this.pause=function(){t.video.playbackRate=0},this.setLoopBounds=function(t){o=t||e},this.onTimeUpdate=function(){var e;if(!i&&(o.start||o.end)){e=t.video;var n=e.currentTime;o.start&&n<o.start?e.currentTime=o.start:o.end&&n>o.end&&(e.currentTime=o.start||0)}}}function ScrollService(t,e){var o={fadeInFromBottom:[{key:-1,opacity:0,top:1},{key:-.5,opacity:0,top:.5,ease:"out"},{key:0,opacity:1,top:0},{key:1,opacity:0,top:0}],slideInFromBottom:[{key:0,top:1,ease:"out"},{key:.8,top:0},{key:1.2,top:0,ease:"in"},{key:2,top:-1}],highlightStart:[{key:-.5,top:0,left:1,metaOpacity:0}],construct:function(t,e){return t=_.clone(t,!0),_.forEach(e,function(e){var o=_.find(t,{key:e.key});if(o)o=_.merge(o,e);else{var i=_.sortedIndex(t,e,"key");t.splice(i,0,e)}}),t}};this.init=function(t){this.$el=t.el,this.annotationInfo=[],this.height=window.innerHeight,this.navHeight=80,this.slides=[],this.$slides=[],this.timecodeMap={},this.currentLoop=0,this.headers=document.getElementsByClassName("top-nav-author"),this.navButtons=document.getElementsByClassName("side-nav-circle"),this.$background=angular.element(document.getElementsByClassName("shot-background")[0]),this.$play=angular.element(document.getElementsByClassName("shot-video-play")[0]),window.addEventListener("resize",angular.bind(this,this.sizeAndPosition)),this.boundOnscroll=angular.bind(this,this.onscroll),this.nextDraw()},this.keyFrames={introduction:[{key:0,backgroundOpacity:1,opacity:1,playOpacity:1},{key:.8,opacity:0,playOpacity:1},{key:.9,opacity:0,playOpacity:0},{key:1,backgroundOpacity:0,opacity:0,playOpacity:0}],outro:[{key:-.3,backgroundOpacity:1,opacity:0},{key:0,backgroundOpacity:0,opacity:0},{key:.5,opacity:1},{key:10,opacity:1}],shotvideo:[{key:0,backgroundOpacity:1},{key:.2,backgroundOpacity:0},{key:.8,backgroundOpacity:0},{key:1,backgroundOpacity:1}],author:[{key:0,opacity:0},{key:.5,opacity:1,left:0,top:0,scale:1},{key:1,left:0,top:0,scale:1,ease:"in-out"},{key:1.5,top:-.3,left:-.41,scale:.45}],background:[{key:-.5,top:1,ease:"out",metaOpacity:1},{key:.2,top:0,metaOpacity:1},{key:.9,metaOpacity:1},{key:1,top:0,metaOpacity:0}],"bg-video":[{key:-.5,top:1},{key:0,top:0},{key:2.5,top:0},{key:3,top:-1}],"main-title":{"slide-inner":{frames:[{key:-.9,top:1,ease:"out"},{key:-.3,top:0},{key:1.5,top:0},{key:2,top:-1}]},"slide-main-title-description":{frames:[{key:-.3,top:1,ease:"out"},{key:.3,top:0}]},"slide-main-title-subtitle":{frames:[{key:.3,top:1,ease:"out"},{key:.9,top:0}]},"slide-main-title-play":{frames:[{key:.3,top:1,ease:"out"},{key:.9,top:0}]}},text:o.fadeInFromBottom,column:o.fadeInFromBottom,highlight:o.highlightStart,photo:o.slideInFromBottom,streetview:o.slideInFromBottom,video:[{key:0,top:1,ease:"out"},{key:.5,top:0},{key:1,top:0},{key:1.5,top:-1}]},this.easing={linear:function(t){return t},"in":function(t){return t*t},out:function(t){return t*(t-2)*-1},"in-out":function(t){return t=2*t,1>t?t*t*.5:-.5*(--t*(t-2)-1)},"cube-in":function(t){return t*t*t},"cube-out":function(t){return(t-=1)*t*t+1}},this.setSlides=function(t){this.slides=t;var e=this;window.setTimeout(function(){e.$slides=e.$el[0].getElementsByClassName("slide"),e.sizeAndPosition()},100)},this.scrollToSlide=function(t){window.scrollTo(0,t.padded_top)},this.sizeAndPosition=function(){var t=window.innerHeight;this.height=t,this.halfHeight=this.height/2,this.doubleHeight=2*this.height;var o,i,n=0,r=0,a=window.innerWidth,s=document.querySelector(".shot-video-directive"),l=s?s.clientWidth:a,c=l/a,u=(a-l)/2/a;0>u&&(u=0),!this.slides||this.slides.length<1||this.$slides.length<1||(angular.forEach(this.slides,function(a,s){var l=this.$slides[s];if(a.top=l.offsetTop,a.height=l.offsetHeight,a.bottom=a.top+a.height,a.padded_top="main-title"!==a.type?Math.round(a.top+(a.height-this.height)/2):a.bottom-this.height,a.el=l,a.$el=angular.element(l),a.$inner=a.$el.find("div").eq(0),a.$container=angular.element(a.$inner[0].children[0]),a.$meta=angular.element(a.el.getElementsByClassName("meta-text")[0]),a.index=s,a.keyFrames=_.clone(this.keyFrames[a.type],!0)||[],_.isArray(a.keyFrames)||_.each(a.keyFrames,function(t,e){t.$el=angular.element(a.$el[0].getElementsByClassName(e))}),"highlight"===a.type){var d=a.annotation.highlight.x/100;d=u+d*c;var h=a.annotation.highlight.y/100;a.keyFrames=a.keyFrames.concat([{key:0,top:h,left:d,metaOpacity:0},{key:.2,top:h,left:d,metaOpacity:1},{key:.7,top:h,left:d,metaOpacity:1,opacity:1},{key:1,top:h,left:d,metaOpacity:0,opacity:0}])}if("column"===a.type){var v=a.keyFrames.length-1,p=a.keyFrames[v],m=a.$el[0].offsetHeight,g=Number(window.getComputedStyle(a.$container[0]).getPropertyValue("width").replace("px","")),f=150,y=a.$el[0].querySelectorAll("img");y.forEach(function(t){if(t.width>0){var e=g/t.width;m=m-t.height+t.height*e}else t.parentNode.removeChild(t);angular.element(t).css({width:"100%",height:"auto"})}),p.key=m/t,p.opacity=1,a.keyFrames[v]=p,a.$el.css("height",m+f+"px")}if((a.isHeader||"author"===a.type)&&(a.headerEl=this.headers[n],n++),a.isNav&&(a.navButton=this.navButtons[r],r++),o&&a.annotation!==o.annotation&&(o.keyFrames=o.keyFrames.concat([{key:s-o.index+.5,opacity:1,top:-.3,left:-.41,scale:.45},{key:s-o.index+1,opacity:0,top:-.3,left:-.41,scale:.45}]),o=null),"author"===a.type&&(o=a),i&&a.annotation!==i.annotation&&(i.keyFrames=i.keyFrames.concat([{key:s-i.index-1,opacity:1,top:0,metaOpacity:0},{key:s-i.index-.5,opacity:0,top:-1,metaOpacity:0}]),i=null),"background"===a.type&&(i=a),a.attributes&&a.attributes.loop){if("string"==typeof a.attributes.loop){var b=a.attributes.loop.split(",");if(b.length>1){var w={start:Number(b[0]),end:Number(b[1])};a.attributes.loop=w}}this.timecodeMap[a.index]=a.attributes.loop}var S=l.querySelectorAll(".footnote");S&&S.forEach(function(t){var o=t.innerHTML.replace(/{|}/g,""),i="#"+e.volume+"/"+e.shot;"Footnotes"===a.nav?(t.id="source"+o,t.href=i+"#ref"+o,[].filter.call(document.getElementsByTagName("p"),function(t){return 0==t.childElementCount&&""==t.textContent.trim()}).forEach(function(t){t.parentNode.removeChild(t)})):(t.id="ref"+o,t.href=i+"#source"+o)})},this),this.lastY=void 0,this.reflow())},this.currentSlide={},this.currentAnnotation={},this.nextDraw=function(){this.animationFrame=window.requestAnimationFrame(this.boundOnscroll)},this.reflow=function(){window.cancelAnimationFrame(this.animationFrame),this.onscroll()},this.onscroll=function(){var e=window.scrollY;if(!this.slides||!this.slides.length||e===this.lastY||0>e)return this.nextDraw();this.lastY=e;var o=this.height;return angular.forEach(this.slides,function(i,n){var r=(e-i.top)/o,a=i.keyFrames;if(a){var s=_.isArray(a)?a:a["slide-inner"].frames,l=s.length,c=_.sortedIndex(s,{key:r},"key"),u=0===c&&r<s[0].key;if(u)return i.hidden||(i.$inner.css({visibility:"hidden"}),i.hidden=!0),void 0;var d=c===l&&r>s[l-1].key;if(d)return i.hidden||(i.$inner.css({visibility:"hidden"}),i.hidden=!0),void 0;if(i.hidden=!1,e>=i.top&&e<=i.bottom){if(this.currentSlide!==i)if(this.currentSlide.onExit&&this.currentSlide.onExit(),i.onEnter&&i.onEnter(),this.currentSlide=i,i.attributes&&i.attributes.loop)t.setLoopBounds(i.attributes.loop),this.currentLoop=i.index;else if(i.index<this.currentLoop)for(n=i.index;n>=0;n--)if(this.timecodeMap[n])return t.setLoopBounds(this.timecodeMap[n]),!1;var h,v=i.headerEl,p=i.navButton;if(v||(h=this.slides.slice(0,n),_.forEachRight(h,function(t){return t.headerEl?(v=t.headerEl,!1):void 0})),p||(h=this.slides.slice(0,n),_.forEachRight(h,function(t){return t.navButton?(p=t.navButton,!1):void 0})),v&&(!this.lastHeader||this.lastHeader!==v)){var m;angular.forEach(this.headers,function(t){var e=angular.element(t);t===v?(m=e,e.removeClass("up").removeClass("down")):m?e.addClass("down").removeClass("up"):e.addClass("up").removeClass("down")},this),this.lastHeader=v}!p||this.lastNav&&this.lastNav===p||(this.lastNav&&angular.element(this.lastNav).removeClass("highlighted"),angular.element(p).addClass("highlighted"),this.lastNav=p)}var g,f,y,b={};y=_.isArray(a)?[{$el:i.$inner,frames:a}]:_.toArray(a),_.each(y,function(t){a=t.frames,_.forEach(a,function(t){if(r===t.key)return b=_.omit(t,["key","event"]),!1;if(!(r>t.key)){var e=(r-g)/(t.key-g),o=this.easing[f](e),i={};return _.forEach(t,function(t,e){"key"!==e&&"event"!==e&&void 0!==b[e]&&(i[e]=b[e]+(t-b[e])*o)}),b=i,!1}b=_.omit(t,["key","event"]),g=t.key,f=t.ease||"linear"},this);var e=0,o=0,n="";_.forEach(b,function(t,i){"top"===i?o=(t*this.height).toFixed(1)+"px":"left"===i?e=(100*t).toFixed(1)+"%":"scale"===i?n=" scale("+t.toFixed(2)+")":("opacity"===i||"backgroundOpacity"===i)&&(b[i]=t.toFixed(2))},this),t.$el[0]!==i.$inner[0]||_.has(b,"opacity")||(b.opacity=1);var s="translate3d("+e+", "+o+", 0)"+n;t.$el.css({"-webkit-transform":s,transform:s,display:"block",visibility:"visible",opacity:b.opacity}),void 0!==b.metaOpacity&&i.$meta.css({opacity:b.metaOpacity}),void 0!==b.backgroundOpacity&&this.$background.css({opacity:b.backgroundOpacity}),void 0!==b.playOpacity&&this.$play.css({opacity:b.playOpacity})},this)}},this),this.nextDraw()}}function AutoScrollerService(){function t(){var i=window.pageYOffset;if(null!==e&&i!==e&&i!==e-o)return e=null,void 0;var n=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight);return i+window.innerHeight>=n?(e=null,void 0):(e=i+o,window.scrollTo(0,e),window.requestAnimationFrame(t),void 0)}var e=null,o=5;this.autoScroll=function(){window.scrollTo(0,window.innerHeight/2),t()}}function AnalyticsService(t){this.pageview=function(e,o){t.ga&&t.ga("send","pageview",{page:e,title:o})}}function ShotFilter(t){return("00"+t).slice(-2)}function MimeTypeFilter(t){return _.last(t.split("."))}function WebMFilter(t){return t.replace(".mp4",".webmhd.webm")}function SlideManager(t,e){return{restrict:"E",template:['<slide ng-class="{\'slides-loading\': loading}" ng-repeat="slide in slides" data="slide"></slide>'].join(""),scope:{slides:"=?"},link:function(o,i){e.init({el:i}),o.$watch("slides",function(){o.loading=!0,o.$evalAsync(function(){e.setSlides(o.slides),t(function(){o.loading=!1},100)})})}}}function Slide(){return{restrict:"E",templateUrl:"templates/slide.html",link:function(){}}}function BackgroundCoverDirective(t,e){return{restrict:"C",priority:-1,link:function(o,i,n){function r(){var t="IMG"===i[0].tagName?i[0]:i.find("IMG")[0];if(t&&t.height&&t.width){var e=window.innerWidth/window.innerHeight;return t.width/t.height>e&&n.$addClass("fill-height-directive"),"IMG"===i[0].tagName?i.off("load",r):i.find("IMG").off("load",r),!0}return!1}r()||("IMG"===i[0].tagName?i.on("load",r):n.ngBindHtml&&o.$watch("ngBindHtml",function(){t(function(){r()||i.find("IMG").on("load",r)},50)})),angular.element(e).on("resize",_.debounce(r,150))}}}function shotVideoDirective(t,e){return{restrict:"C",link:function(o,i){function n(){var e=parseFloat(r.currentTime.toFixed(1));if(a[e]){t.screenshot(r,e),delete a[e];var o=!1;_.forIn(a,function(t){return t?(o=!0,!1):void 0}),o||(r.removeEventListener("timeupdate",n),a=!1)}}var r=i[0];e.registerShotVideo(r),r.playbackRate=.3,t.screenshots=t.screenshots||{};var a;o.$watch("shot.annotations",function(){a=!1,_.forEach(o.shot.annotations,function(e){var o=e.timecodes,i=o&&void 0!==o.start;i&&!t.screenshotTaken(r,o.start)&&(a=a||{},a[o.start]=1)}),a&&r.addEventListener("timeupdate",n)})}}}function StreetView(t){return{restrict:"E",templateUrl:"templates/streetview.html",scope:{url:"@",caption:"@",title:"@",startFrame:"@"},link:function(e){var o=window.innerWidth+"x"+window.innerHeight,i=t.parseStreetViewUrl(e.url,o);e.streetViewImageUrl=t.buildStreetViewAPIUrl(i),e.oneUp=!0,e.goToStreetView=function(){}}}}function VideoFrame(t){return{restrict:"A",scope:{target:"@"},link:function(e,o){var i=e.target||0,n=o[0],r=n.getContext("2d"),a=function(t){n.height=t.height,n.width=t.width,r.putImageData(t,0,0,0,0,t.width,t.height)};t.requestScreenshot(i,a)}}}function FitToWindowDirective(t,e){return{restrict:"C",priority:-1,link:function(o,i,n){function r(){var t,o,l,c=e.innerWidth/e.innerHeight;s?(l=i.find("IMG")[0],t=l&&l.height,o=l&&l.width):"VIDEO"===a.tagName?(t=a.videoHeight,o=a.videoWidth):"IMG"===a.tagName&&(t=a.height,o=a.width),t&&o&&(o/t>c?n.$addClass("fit-to-window-width-directive"):n.$removeClass("fit-to-window-width-directive"),s?i.find("IMG").off("load",r):i.off("load",r))}var a=i[0],s=n.ngBindHtml;s?o.$watch("ngBindHtml",function(){t(function(){i.find("IMG").on("load",r),r()},50)}):i.on("load",r),r(),angular.element(e).on("resize",_.debounce(r,150))}}}function VideoContainer(t){return{restrict:"A",link:function(e,o){function i(){var t;switch(a){case"html5":t=o.find("video")[0];break;case"vimeo":t=o.find("iframe")[0];break;case"youtube":t=o.find("iframe")[0]}return t}var n=o[0],r=(angular.element(n),e.slide),a="",s=!1;r.attributes.video?a="html5":r.annotation.content.indexOf("vimeo")>=0?a="vimeo":r.annotation.content.indexOf("youtube")>=0&&(a="youtube"),t.$on("videoEnter",function(t,e){e===r&&("html5"!==a||s||(i().play(),s=!0))}),t.$on("videoExit",function(t,e){if(e===r&&"html5"===a){var o=i();o.pause()}})}}}angular.module("shotbyshot",["ngAnimate","ngCookies","ngTouch","ngSanitize","ui.router"]).config(["$stateProvider","$urlRouterProvider","$sceDelegateProvider",function(t,e,o){t.state("volume",{template:"<ui-view/>",url:"/:volume","abstract":!0,controller:["$scope","$stateParams",function(t,e){t.volume=e.volume}]}).state("volume.shot",{url:"/:shot",templateUrl:"partials/shot.html",controller:"ShotCtrl",controllerAs:"shot"}),e.otherwise("/01/01"),o.resourceUrlWhitelist(["self","https://worldrecordsjournal.org/wp/wp-content/uploads/**","https://s3.amazonaws.com/world-records-journal/**","https://s3.amazonaws.com/world-records-journal/","player.vimeo.com/video/**","http://cf.lossur.es/**","http://d16hdktz6rtx08.cloudfront.net/**"])}]),ShotCtrl.$inject=["$scope","$sce","$filter","$timeout","$state","$stateParams","ShotService","AnnotationParserService","ShotVideoService","ScrollService","AnalyticsService","AutoScrollerService"],angular.module("shotbyshot").controller("ShotCtrl",ShotCtrl),ShotService.$inject=["$rootScope","$http","$filter","$stateParams","$q","AnnotationsService"],angular.module("shotbyshot").service("ShotService",ShotService),AnnotationsService.$inject=["Annotation"],angular.module("shotbyshot").service("AnnotationsService",AnnotationsService),AnnotationParserService.$inject=["$sce","$rootScope","Annotation"],angular.module("shotbyshot").service("AnnotationParserService",AnnotationParserService),angular.module("shotbyshot").factory("Annotation",Annotation),angular.module("shotbyshot").service("StreetViewService",StreetViewService),VideoService.$inject=["ShotService"],angular.module("shotbyshot").service("VideoService",VideoService),angular.module("shotbyshot").service("ShotVideoService",ShotVideoService),ScrollService.$inject=["ShotVideoService","$stateParams"],angular.module("shotbyshot").service("ScrollService",ScrollService),angular.module("shotbyshot").service("AutoScrollerService",AutoScrollerService),AnalyticsService.$inject=["$window"],angular.module("shotbyshot").service("AnalyticsService",AnalyticsService),angular.module("shotbyshot").filter("shot",function(){return ShotFilter}),angular.module("shotbyshot").filter("mimetype",function(){return MimeTypeFilter}),angular.module("shotbyshot").filter("webm",function(){return WebMFilter}),SlideManager.$inject=["$timeout","ScrollService"],angular.module("shotbyshot").directive("slideManager",SlideManager),angular.module("shotbyshot").directive("slide",Slide),BackgroundCoverDirective.$inject=["$timeout","$window"],angular.module("shotbyshot").directive("backgroundCoverDirective",BackgroundCoverDirective),shotVideoDirective.$inject=["VideoService","ShotVideoService"],angular.module("shotbyshot").directive("shotVideoDirective",shotVideoDirective),StreetView.$inject=["StreetViewService"],angular.module("shotbyshot").directive("streetView",StreetView),VideoFrame.$inject=["VideoService"],angular.module("shotbyshot").directive("videoFrame",VideoFrame),FitToWindowDirective.$inject=["$timeout","$window"],angular.module("shotbyshot").directive("fitToWindowDirective",FitToWindowDirective),VideoContainer.$inject=["$rootScope"],angular.module("shotbyshot").directive("videoContainer",VideoContainer),function(t){try{t=angular.module("shotbyshot")}catch(e){t=angular.module("shotbyshot",[])}t.run(["$templateCache",function(t){t.put("partials/nav.html",'<nav class="top-nav" ng-class="{menu: menuIsOn && !globalIsOn, global: globalIsOn}"><button class="top-nav-menu-button" ng-if="!menuIsOn" ng-click="toggleGlobalMenu()"></button> <button class="top-nav-menu-button" ng-if="menuIsOn && !globalIsOn" ng-click="toggleMenu()"></button><div class="top-nav-header" ng-show="shot.id" ng-click="toggleMenu()"><div ng-include="\'../images/WR_half_logo.svg\'" class="top-nav-logo"></div><div class="top-nav-breadcrumbs"><div class="top-nav-desktop"><div class="top-nav-shot-current">Volume {{ volume | number }} &nbsp; \\ &nbsp; Article {{ shot.id }} &nbsp; \\ &nbsp;</div><div class="top-nav-current-slide"><div class="top-nav-author down" ng-repeat="slide in shot.slides | filter:isHeaderSlide">{{ slide.nav || slide.annotation.author.name }}</div></div></div><div class="top-nav-mobile"><div class="top-nav-shot-current">{{ volume }} - {{ getArticleNumber(shot.id) }}</div></div></div><div class="top-nav-index-label">Volume Index & Article Detail <span class="down-chevron">^</span></div></div><div class="nav-menu"><div class="nav-menu-inner"><h4>Article Detail</h4><div class="nav-menu-details"><div class="nav-menu-appellation"><h1>{{ shot.annotations[0].title }}</h1><h3>{{ shot.annotations[0].author.name }}</h3><div class="nav-menu-utilities"><a href="#" class="pdf-download"></a> <a href="#">Share</a> <a href="#">Notes</a></div></div><div class="nav-menu-description"><p ng-bind-html="shot.annotations[0].author.description"></p></div></div><div class="nav-menu-controls"><div class="nav-menu-tabs"><a class="nav-menu-tab" ng-repeat="tab in [\'shots\', \'tags\']" ng-click="$parent.showMenuTab = tab; $parent.filterShots();" ng-bind="tab" ng-class="{on: showMenuTab === tab}"></a></div></div><div class="nav-menu-shots" ng-show="showMenuTab === \'shots\'"><h4>{{ currentVolume.title }}</h4><div class="nav-menu-scrollable"><a class="nav-menu-shot" ng-repeat="shot in shots | orderBy:\'slug\'" href="#/{{volume}}/{{shot.index}}"><div class="nav-menu-shot-thumb"><img ng-src="{{ thumbnailForShot( shot ) }}"></div><div class="nav-menu-shot-number">{{ shot.index | number }}</div><div class="nav-menu-shot-details"><p><strong>{{ shot.title }}</strong></p><p>{{ shot.annotations[0].author.name }}</p></div></a></div></div><div class="nav-menu-tags" ng-show="showMenuTab === \'tags\'"><div class="nav-menu-scrollable"><a class="nav-menu-tag" ng-repeat="tag in shot.tags" ng-bind-html="tag.title" ng-click="$parent.filterShots(tag); $parent.showMenuTab = \'shots\';"></a></div></div></div></div><div class="nav-global"><div><a href="https://worldrecordsjournal.org" target="_blank">About</a></div><div><a href="https://worldrecordsjournal.org/volumes/" target="_blank">Volumes</a></div><div><a href="https://worldrecordsjournal.org/subscribe-to-world-records/" target="_blank">Subscribe</a></div><div><a href="https://worldrecordsjournal.org/join/" target="_blank">Newsletter Signup</a></div><div><a href="https://worldrecordsjournal.org/submissions/" target="_blank">Call for Submissions</a></div><div><a href="https://worldrecordsjournal.org/contact/" target="_blank">Contact</a></div><div class="copyright">© <strong>UnionDocs, Inc.</strong> 2018</div></div></nav><nav class="side-nav"><ul class="side-nav-circles"><li class="side-nav-circle" ng-repeat="slide in shot.slides | filter:isNavSlide" ng-click="scrollToSlide(slide)"><div class="side-nav-tag">{{ slide.nav || slide.annotation.author.name }}</div></li></ul></nav>')}])}(),function(t){try{t=angular.module("shotbyshot")}catch(e){t=angular.module("shotbyshot",[])}t.run(["$templateCache",function(t){t.put("partials/shot.html",'<div class="container"><div ng-class="{\'cinema\': shot.playing}" ng-include="\'partials/nav.html\'"></div><div class="content" ng-class="{\'shot-ready\': shot.ready, \'cinema\': shot.playing}"><div class="shot-background" ng-style="{\'opacity\': shot.backgroundOpacity}"></div><video class="shot-video-directive" crossorigin="" autoplay="" loop="" muted=""><source ng-src="{{ shot.videoUrl }}" type="video/mp4"><source ng-src="{{ shot.videoUrl | webm }}" type="video/webm">Your browser does not support the <code>video</code> element.</video><div class="shot-video-play" ng-show="shot.ready && inView && !shot.playing" ng-click="shot.play()"></div><div class="slides"><slide-manager slides="shot.slides"></slide-manager></div></div></div>')}])}();