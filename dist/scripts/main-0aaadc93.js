"use strict";function ShotCtrl(e,t,i,n,o,a,r,s,l,c,d){var u=this;this.id=a.current,this.next=a.getNext(),this.previous=a.getPrevious(),this.videoUrl=a.getVideoUrl(),this.shots=[],this.thumbsForTag={},c.pageview(window.location.href,document.title+" - Shot "+this.id),e.menuIsOn=!1,e.showMenuTab="shots",angular.element(document.body).removeClass("noscroll");var h=3e4;this.played=!1,this.play=function(){u.played=!0,u.backgroundOpacity=0,u.playing=!0,s.play(function(){u.stop(),d.autoScroll()})},this.stop=function(){u.playing=!1,s.resumeLoop(),u.backgroundOpacity=1,e.$apply()};var v=!0;this.id&&a.getShot(this.id).then(function(t){window.location.search.indexOf("installation")>=0&&n(function(){u.played||u.play()},h);var i=[{type:"introduction",shot:u.id,nav:"Volume Index",onEnter:function(){e.inView=!0,u.ready||n(function(){u.ready=!0},3e3),e.$apply()},onExit:function(){e.inView=!1,u.stop()}}],a=[{shot:u.id,type:"outro",next:u.next,onEnter:function(){window.location.search.indexOf("installation")>=0&&n(function(){v&&(l.scrollToSlide(u.slides[0]),o.go("shot",{shot:u.next||1}))},h)},onExit:function(){v=!1}}],s=i.concat(r.parse(t),a);u.annotations=t,u.slides=s,_.each(s,function(t){t.isNav=e.isNavSlide(t),t.isHeader=e.isHeaderSlide(t)})}),a.getThumbnails(0).then(function(t){e.thumbs=u.thumbs=t;var i=_.findIndex(t,function(e){return parseInt(e.slug,10)===u.id}),o=275,a=o*Math.floor(i/2);n(function(){document.querySelector(".nav-menu-shots").scrollTop=a},300)}),a.getTags(0).then(function(e){u.tags=_.map(_.sortBy(e,function(e){return-e.post_count}).slice(0,30),function(e){return e.title=e.title.replace(/\s/g,"&nbsp;"),e})}),e.isHeaderSlide=function(e){var t=["introduction","text","column","outro","author","photo","video","streetview","bg-video"];return _.contains(t,e.type)},e.isNavSlide=function(e){var t=["introduction","text","column","author","photo","video","streetview","main-title"];return _.contains(t,e.type)},e.scrollToSlide=function(e){l.scrollToSlide(e)},e.thumbnailForShot=function(e){return"/wp/wp-content/uploads/Shots_400px/"+e.slug+".png"},e.toggleMenu=function(){e.menuIsOn?(s.resumeLoop(),angular.element(document.body).removeClass("noscroll")):(s.pause(),angular.element(document.body).addClass("noscroll")),e.menuIsOn=!e.menuIsOn},e.toggleGlobalMenu=function(){e.globalIsOn?(s.resumeLoop(),angular.element(document.body).removeClass("noscroll")):(s.pause(),angular.element(document.body).addClass("noscroll")),e.globalIsOn=!e.globalIsOn},e.filterShots=function(t){t?u.thumbsForTag[t.id]?e.thumbs=u.thumbsForTag[t.id]:a.getAnnotationsForTag(t,0).then(function(i){var n={};_.each(i,function(e){e.categories.length&&(n[e.categories[0].id]=e.categories[0])}),e.thumbs=u.thumbsForTag[t.id]=_.toArray(n)}):e.thumbs=u.thumbs}}function ShotService(e,t,i,n,o,a){var r=this,s=parseInt(n.shot,10);document.title=document.title+" - Vol "+romanize(s),this.current=isNaN(s)?0:s,this.getVideoUrl=function(){var e="https://s3.amazonaws.com/world-records-journal/"+i("shot")(this.current)+".mp4";return e};var l=300;this.getNext=function(){var e=this.current+1;return l>=e?e:null},this.getPrevious=function(){var e=this.current-1;return e>=0?e:null},this.cache=[];var c="/wp/?json=get_category_posts&post_type=mm_annotation&slug=";this.getShot=function(e){var n=o.defer(),s="number"!=typeof e||isNaN(e)?this.current:e;if(this.cache[s])return n.resolve(this.cache[s]),n.promise;var l=c+i("shot")(s);return t({method:"GET",url:l}).success(function(e){r.cache[s]=a.parse(e.posts),n.resolve(r.cache[s])}).error(function(){n.reject("Error fetching shot "+s)}),n.promise};var d="/wp/?json=get_category_index";this.getThumbnails=function(e){var i=o.defer();return e=e||0,t({method:"GET",url:d+"&page="+e}).success(function(e){"ok"===e.status?(i.resolve(e.categories),l=parseInt(_.last(e.categories).slug,10)):i.reject("Error fetching shots")}).error(function(){i.reject("Error fetching shots")}),i.promise};var u="/wp/?json=get_tag_posts";this.getAnnotationsForTag=function(e,i){var n=o.defer();return i=i||0,t({method:"GET",url:u+"&id="+e.id+"&page="+i}).success(function(e){"ok"===e.status?n.resolve(e.posts):n.reject("Error fetching shots")}).error(function(){n.reject("Error fetching shots")}),n.promise};var h="/wp/?json=get_tag_index";this.getTags=function(e){var i=o.defer();return e=e||0,t({method:"GET",url:h+"&page="+e}).success(function(e){"ok"===e.status?i.resolve(e.tags):i.reject("Error fetching shots")}).error(function(){i.reject("Error fetching shots")}),i.promise},e.$on("$stateChangeStart",function(e,t,i){var n=parseInt(i.shot,10);!isNaN(n)&&n>=0&&l>=n&&(r.current=n)})}function romanize(e){if(!+e)return 0/0;for(var t=String(+e).split(""),i=["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM","","X","XX","XXX","XL","L","LX","LXX","LXXX","XC","","I","II","III","IV","V","VI","VII","VIII","IX"],n="",o=3;o--;)n=(i[+t.pop()+10*o]||"")+n;return Array(+t.join("")+1).join("M")+n}function AnnotationsService(e){this.parse=function(t){var i=[];return angular.forEach(t,function(t){i.push(new e(t))}),i}}function AnnotationParserService(e,t){this.parse=function(i){var n=[];return angular.forEach(i,function(i){var o=i.content,a=o.split(/\[slide\s*/gi);return a.length<2?(n.push({type:"text",content:o,attributes:{text:void 0},annotation:i}),!1):(a=a.slice(1),angular.forEach(a,function(a){var r=a.split("]");if(r.length<2)throw new Error('Slide tag "'+r[0]+'" did not have closing bracket: '+o);var s=r[0],l=r[1],c=/(\w+)(?=$|\s|=)/i,d=c.exec(s);if(null===d)throw new Error("Could not determine type of slide tag: "+a);d=d[1].toLowerCase();var u={text:1,column:1,background:1,photo:1,highlight:1,audio:1,video:1,streetview:1};if(!u[d])throw new Error("Type not allowed: "+d);var h={};s=s.replace(/&#8220;|&#8221;|&#8243;/g,'"'),s=s.replace(/&#8216;|&#8217;|&#8242;/g,"'"),s=s.replace(/&#8211;|&#8212;/g,"-");for(var v,p,m,g=/(\w+)=("[^"]*"|'[^']*'|\w+)/g,f=s;null!==(v=g.exec(s));)p=v[1].toLowerCase(),m=v[2],('"'===m.charAt(0)||"'"===m.charAt(0))&&(m=m.slice(1,-1)),"video"===p&&(m=m.split(",")),h[p]=m,f=f.replace(v[0],"");angular.forEach(f.split(/\s+/g),function(e){e&&(h[e]=void 0)}),h.caption&&(h.caption=h.caption.replace(/\<br\s*\/*\>/gi,"")),("photo"===d||"background"===d||"video"===d)&&(l=l.replace(/\<br\s*\/*\>/gi,""),"video"===d&&(l=l.replace(/width\=\"[0-9a-z]+\"/gi,""),l=l.replace(/height\=\"[0-9a-z]+\"/gi,"")));var y={type:d,content:e.trustAsHtml(l),attributes:h,annotation:i},w={photo:"photos",video:"video",streetview:"Then & Now"};y.nav=h.title||w[d],"video"===d&&(y.onEnter=function(){t.$broadcast("videoEnter",y)},y.onExit=function(){t.$broadcast("videoExit",y)}),n.push(y)}),void 0)}),n}}function Annotation(){function e(e){function t(e){var t=i&&i[e]&&i[e][0];return t||""}if(e){this.author={name:e.author&&e.author.name,image:"/wp/wp-content/uploads/authors/"+e.author.nickname+".jpg"},this.content=e.content||"";var i=e.custom_fields,n=t("mm_annotation_streetview"),o=t("mm_annotation_start_timecode"),a=t("mm_annotation_end_timecode"),r=t("mm_annotation_x"),s=t("mm_annotation_y");n&&(this.streetView=n),(o||a)&&(this.timecodes={start:o&&parseFloat(o)||0,end:a&&parseFloat(a)||0}),(r||s)&&(this.highlight={x:r&&parseFloat(r)||0,y:s&&parseFloat(s)||0});var l={};e.tags&&e.tags.length&&angular.forEach(e.tags,function(e){l[e.title]=1}),this.tags=l}}return e}function StreetViewService(){var e="//maps.googleapis.com/maps/api/streetview?",t="AIzaSyCru1EQFOIRQgaalFfc7TtJH0S6TosODQ4",i=t?"https:":"";this.parseStreetViewUrl=function(e,t){var i={size:t||"200x200",sensor:"false"},n=/www\.google\.com\/maps.*\/@([^\/]+)\//,o=n.exec(e);return o?(o=o[1].split(","),i.location=o[0]+","+o[1],i.fov=parseInt(o[3].replace("y",""),10),i.heading=parseFloat(o[4].replace("h","")),i.pitch=parseFloat(o[5].replace("t",""))-90,i):!1},this.buildStreetViewAPIUrl=function(n){var o=[];for(var a in n)o.push(a+"="+n[a]);return t&&o.push("key="+t),i+e+o.join("&")}}function VideoService(e){var t=document.createElement("canvas"),i=t.getContext("2d"),n=[],o=[];this.screenshotTaken=function(t){t=t||0;var i=e.current,o=n[i];return o&&o[t]};var a=function(e){var n=e.videoHeight,o=e.videoWidth;return t.height=n,t.width=o,i.drawImage(e,0,0),i.getImageData(0,0,o,n)};this.screenshot=function(t,i){var r=e.current,s=!n[r],l=n[r]||{};l[i]=a(t),n[r]=l;var c=o[r],d=c&&c[i];if(d&&d.length){for(;d.length;)d.pop()(l[i]);o[r][i]=null}s&&c&&_.forIn(c,function(e){_.forEach(e,function(e){e(l[i])})})},this.requestScreenshot=function(t,i){var a=e.current,r=n[a]||{};r[t]?i(r[t]):(o[a]=o[a]||{},o[a][t]=o[a][t]||[],o[a][t].push(i),r[0]?i(r[0]):_.forIn(r,function(e){return i(e),!1}))}}function ShotVideoService(){var e=this,t={start:0,end:0},i=t,n=!1,o=null;this.registerShotVideo=function(n){e.video&&e.video.removeEventListener("timeupdate",e.onTimeUpdate,!1),e.video=n,i=t,e.video.addEventListener("timeupdate",e.onTimeUpdate,!1)},this.play=function(t){e.video.readyState<2||(n=!0,o=t,e.video.currentTime=0,e.video.playbackRate=1,e.video.muted=!1,e.video.loop=!1,t&&e.video.addEventListener("ended",o,!1))},this.resumeLoop=function(){e.video.readyState<2||(n=!1,e.video.playbackRate=.3,e.video.muted=!0,e.video.loop=!0,e.video.removeEventListener("ended",o,!1),o=null,e.video.currentTime=0,e.video.play())},this.pause=function(){e.video.playbackRate=0},this.setLoopBounds=function(e){i=e||t},this.onTimeUpdate=function(){var t;if(!n&&(i.start||i.end)){t=e.video;var o=t.currentTime;i.start&&o<i.start?t.currentTime=i.start:i.end&&o>i.end&&(t.currentTime=i.start||0)}}}function ScrollService(e){var t={fadeInFromBottom:[{key:-1,opacity:0,top:1},{key:-.5,opacity:0,top:.5,ease:"out"},{key:0,opacity:1,top:0},{key:1,opacity:0,top:0}],slideInFromBottom:[{key:0,top:1,ease:"out"},{key:.8,top:0},{key:1.2,top:0,ease:"in"},{key:2,top:-1}],highlightStart:[{key:-.5,top:0,left:1,metaOpacity:0}],construct:function(e,t){return e=_.clone(e,!0),_.forEach(t,function(t){var i=_.find(e,{key:t.key});if(i)i=_.merge(i,t);else{var n=_.sortedIndex(e,t,"key");e.splice(n,0,t)}}),e}};this.init=function(e){this.$el=e.el,this.annotationInfo=[],this.height=window.innerHeight,this.navHeight=80,this.slides=[],this.$slides=[],this.headers=document.getElementsByClassName("top-nav-author"),this.navButtons=document.getElementsByClassName("side-nav-circle"),this.$background=angular.element(document.getElementsByClassName("shot-background")[0]),this.$play=angular.element(document.getElementsByClassName("shot-video-play")[0]),window.addEventListener("resize",angular.bind(this,this.sizeAndPosition)),this.boundOnscroll=angular.bind(this,this.onscroll),this.nextDraw()},this.keyFrames={introduction:[{key:0,backgroundOpacity:1,opacity:1,playOpacity:1},{key:.8,opacity:0,playOpacity:1},{key:.9,opacity:0,playOpacity:0},{key:1,backgroundOpacity:0,opacity:0,playOpacity:0}],outro:[{key:-.3,backgroundOpacity:1,opacity:0},{key:0,backgroundOpacity:0,opacity:0},{key:.5,opacity:1},{key:10,opacity:1}],shotvideo:[{key:0,backgroundOpacity:1},{key:.2,backgroundOpacity:0},{key:.8,backgroundOpacity:0},{key:1,backgroundOpacity:1}],author:[{key:0,opacity:0},{key:.5,opacity:1,left:0,top:0,scale:1},{key:1,left:0,top:0,scale:1,ease:"in-out"},{key:1.5,top:-.3,left:-.41,scale:.45}],background:[{key:-.5,top:1,ease:"out",metaOpacity:1},{key:.2,top:0,metaOpacity:1},{key:.9,metaOpacity:1},{key:1,top:0,metaOpacity:0}],"bg-video":[{key:-.5,top:1},{key:0,top:0},{key:2.5,top:0},{key:3,top:-1}],"main-title":{"slide-inner":{frames:[{key:-.9,top:1,ease:"out"},{key:-.3,top:0},{key:1.5,top:0},{key:2,top:-1}]},"slide-main-title-description":{frames:[{key:-.3,top:1,ease:"out"},{key:.3,top:0}]},"slide-main-title-subtitle":{frames:[{key:.3,top:1,ease:"out"},{key:.9,top:0}]},"slide-main-title-play":{frames:[{key:.3,top:1,ease:"out"},{key:.9,top:0}]}},text:t.fadeInFromBottom,column:t.fadeInFromBottom,highlight:t.highlightStart,photo:t.slideInFromBottom,streetview:t.slideInFromBottom,video:[{key:0,top:1,ease:"out"},{key:.5,top:0},{key:1,top:0},{key:1.5,top:-1}]},this.easing={linear:function(e){return e},"in":function(e){return e*e},out:function(e){return e*(e-2)*-1},"in-out":function(e){return e=2*e,1>e?e*e*.5:-.5*(--e*(e-2)-1)},"cube-in":function(e){return e*e*e},"cube-out":function(e){return(e-=1)*e*e+1}},this.setSlides=function(e){this.slides=e;var t=this;window.setTimeout(function(){t.$slides=t.$el[0].getElementsByClassName("slide"),t.sizeAndPosition()},100)},this.scrollToSlide=function(e){window.scrollTo(0,e.padded_top)},this.sizeAndPosition=function(){var e=window.innerHeight;this.height=e,this.halfHeight=this.height/2,this.doubleHeight=2*this.height;var t,i,n=0,o=0,a=window.innerWidth,r=document.querySelector(".shot-video-directive"),s=r?r.clientWidth:a,l=s/a,c=(a-s)/2/a;0>c&&(c=0),!this.slides||this.slides.length<1||this.$slides.length<1||(angular.forEach(this.slides,function(a,r){var s=this.$slides[r];if(a.top=s.offsetTop,a.height=s.offsetHeight,a.bottom=a.top+a.height,a.padded_top="main-title"!==a.type?Math.round(a.top+(a.height-this.height)/2):a.bottom-this.height,a.el=s,a.$el=angular.element(s),a.$inner=a.$el.find("div").eq(0),a.$container=angular.element(a.$inner[0].children[0]),a.$meta=angular.element(a.el.getElementsByClassName("meta-text")[0]),a.index=r,a.keyFrames=_.clone(this.keyFrames[a.type],!0)||[],_.isArray(a.keyFrames)||_.each(a.keyFrames,function(e,t){e.$el=angular.element(a.$el[0].getElementsByClassName(t))}),"highlight"===a.type){var d=a.annotation.highlight.x/100;d=c+d*l;var u=a.annotation.highlight.y/100;a.keyFrames=a.keyFrames.concat([{key:0,top:u,left:d,metaOpacity:0},{key:.2,top:u,left:d,metaOpacity:1},{key:.7,top:u,left:d,metaOpacity:1,opacity:1},{key:1,top:u,left:d,metaOpacity:0,opacity:0}])}if("column"===a.type){var h=a.keyFrames.length-1,v=a.keyFrames[h],p=a.$el[0].offsetHeight,m=Number(window.getComputedStyle(a.$container[0]).getPropertyValue("width").replace("px","")),g=150,f=a.$el[0].querySelectorAll("img");f.forEach(function(e){if(e.width>0){var t=m/e.width;p=p-e.height+e.height*t}else e.parentNode.removeChild(e);angular.element(e).css({width:"100%",height:"auto"})}),v.key=p/e,v.opacity=1,a.keyFrames[h]=v,a.$el.css("height",p+g+"px")}(a.isHeader||"author"===a.type)&&(a.headerEl=this.headers[n],n++),a.isNav&&(a.navButton=this.navButtons[o],o++),t&&a.annotation!==t.annotation&&(t.keyFrames=t.keyFrames.concat([{key:r-t.index+.5,opacity:1,top:-.3,left:-.41,scale:.45},{key:r-t.index+1,opacity:0,top:-.3,left:-.41,scale:.45}]),t=null),"author"===a.type&&(t=a),i&&a.annotation!==i.annotation&&(i.keyFrames=i.keyFrames.concat([{key:r-i.index-1,opacity:1,top:0,metaOpacity:0},{key:r-i.index-.5,opacity:0,top:-1,metaOpacity:0}]),i=null),"background"===a.type&&(i=a)},this),this.lastY=void 0,this.reflow())},this.currentSlide={},this.currentAnnotation={},this.nextDraw=function(){this.animationFrame=window.requestAnimationFrame(this.boundOnscroll)},this.reflow=function(){window.cancelAnimationFrame(this.animationFrame),this.onscroll()},this.onscroll=function(){var t=window.scrollY;if(!this.slides||!this.slides.length||t===this.lastY||0>t)return this.nextDraw();this.lastY=t;var i=this.height;return angular.forEach(this.slides,function(n,o){var a=(t-n.top)/i,r=n.keyFrames;if(r){var s=_.isArray(r)?r:r["slide-inner"].frames,l=s.length,c=_.sortedIndex(s,{key:a},"key"),d=0===c&&a<s[0].key;if(d)return n.hidden||(n.$inner.css({display:"none"}),n.hidden=!0),void 0;var u=c===l&&a>s[l-1].key;if(u)return n.hidden||(n.$inner.css({display:"none"}),n.hidden=!0),void 0;if(n.hidden=!1,t>=n.top&&t<=n.bottom){this.currentSlide!==n&&(this.currentSlide.onExit&&this.currentSlide.onExit(),n.onEnter&&n.onEnter(),this.currentSlide=n,n.annotation&&this.currentAnnotation!==n.annotation&&(this.currentAnnotation=n.annotation,e.setLoopBounds(this.currentAnnotation.timecodes)));var h,v=n.headerEl,p=n.navButton;if(v||(h=this.slides.slice(0,o),_.forEachRight(h,function(e){return e.headerEl?(v=e.headerEl,!1):void 0})),p||(h=this.slides.slice(0,o),_.forEachRight(h,function(e){return e.navButton?(p=e.navButton,!1):void 0})),v&&(!this.lastHeader||this.lastHeader!==v)){var m;angular.forEach(this.headers,function(e){var t=angular.element(e);e===v?(m=t,t.removeClass("up").removeClass("down")):m?t.addClass("down").removeClass("up"):t.addClass("up").removeClass("down")},this),this.lastHeader=v}!p||this.lastNav&&this.lastNav===p||(this.lastNav&&angular.element(this.lastNav).removeClass("highlighted"),angular.element(p).addClass("highlighted"),this.lastNav=p)}var g,f,y,w={};y=_.isArray(r)?[{$el:n.$inner,frames:r}]:_.toArray(r),_.each(y,function(e){r=e.frames,_.forEach(r,function(e){if(a===e.key)return w=_.omit(e,["key","event"]),!1;if(!(a>e.key)){var t=(a-g)/(e.key-g),i=this.easing[f](t),n={};return _.forEach(e,function(e,t){"key"!==t&&"event"!==t&&void 0!==w[t]&&(n[t]=w[t]+(e-w[t])*i)}),w=n,!1}w=_.omit(e,["key","event"]),g=e.key,f=e.ease||"linear"},this);var t=0,i=0,o="";_.forEach(w,function(e,n){"top"===n?i=(e*this.height).toFixed(1)+"px":"left"===n?t=(100*e).toFixed(1)+"%":"scale"===n?o=" scale("+e.toFixed(2)+")":("opacity"===n||"backgroundOpacity"===n)&&(w[n]=e.toFixed(2))},this),e.$el[0]!==n.$inner[0]||_.has(w,"opacity")||(w.opacity=1);var s="translate3d("+t+", "+i+", 0)"+o;e.$el.css({"-webkit-transform":s,transform:s,display:"block",opacity:w.opacity}),void 0!==w.metaOpacity&&n.$meta.css({opacity:w.metaOpacity}),void 0!==w.backgroundOpacity&&this.$background.css({opacity:w.backgroundOpacity}),void 0!==w.playOpacity&&this.$play.css({opacity:w.playOpacity})},this)}},this),this.nextDraw()}}function AutoScrollerService(){function e(){var n=window.pageYOffset;if(null!==t&&n!==t&&n!==t-i)return t=null,void 0;var o=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight);return n+window.innerHeight>=o?(t=null,void 0):(t=n+i,window.scrollTo(0,t),window.requestAnimationFrame(e),void 0)}var t=null,i=5;this.autoScroll=function(){window.scrollTo(0,window.innerHeight/2),e()}}function AnalyticsService(e){this.pageview=function(t,i){e.ga&&e.ga("send","pageview",{page:t,title:i})}}function ShotFilter(e){return("0000"+e).slice(-4)}function MimeTypeFilter(e){return _.last(e.split("."))}function WebMFilter(e){return e.replace(".mp4",".webmhd.webm")}function SlideManager(e,t){return{restrict:"E",template:['<slide ng-class="{\'slides-loading\': loading}" ng-repeat="slide in slides" data="slide"></slide>'].join(""),scope:{slides:"=?"},link:function(i,n){t.init({el:n}),i.$watch("slides",function(){i.loading=!0,i.$evalAsync(function(){t.setSlides(i.slides),e(function(){i.loading=!1},100)})})}}}function Slide(){return{restrict:"E",templateUrl:"templates/slide.html",link:function(){}}}function BackgroundCoverDirective(e,t){return{restrict:"C",priority:-1,link:function(i,n,o){function a(){var e="IMG"===n[0].tagName?n[0]:n.find("IMG")[0];if(e&&e.height&&e.width){var t=window.innerWidth/window.innerHeight;return e.width/e.height>t&&o.$addClass("fill-height-directive"),"IMG"===n[0].tagName?n.off("load",a):n.find("IMG").off("load",a),!0}return!1}a()||("IMG"===n[0].tagName?n.on("load",a):o.ngBindHtml&&i.$watch("ngBindHtml",function(){e(function(){a()||n.find("IMG").on("load",a)},50)})),angular.element(t).on("resize",_.debounce(a,150))}}}function shotVideoDirective(e,t){return{restrict:"C",link:function(i,n){function o(){var t=parseFloat(a.currentTime.toFixed(1));if(r[t]){e.screenshot(a,t),delete r[t];var i=!1;_.forIn(r,function(e){return e?(i=!0,!1):void 0}),i||(a.removeEventListener("timeupdate",o),r=!1)}}var a=n[0];t.registerShotVideo(a),a.playbackRate=.3,e.screenshots=e.screenshots||{};var r;i.$watch("shot.annotations",function(){r=!1,_.forEach(i.shot.annotations,function(t){var i=t.timecodes,n=i&&void 0!==i.start;n&&!e.screenshotTaken(a,i.start)&&(r=r||{},r[i.start]=1)}),r&&a.addEventListener("timeupdate",o)})}}}function StreetView(e){return{restrict:"E",templateUrl:"templates/streetview.html",scope:{url:"@",caption:"@",title:"@",startFrame:"@"},link:function(t){var i=window.innerWidth+"x"+window.innerHeight,n=e.parseStreetViewUrl(t.url,i);t.streetViewImageUrl=e.buildStreetViewAPIUrl(n),t.oneUp=!0,t.goToStreetView=function(){}}}}function VideoFrame(e){return{restrict:"A",scope:{target:"@"},link:function(t,i){var n=t.target||0,o=i[0],a=o.getContext("2d"),r=function(e){o.height=e.height,o.width=e.width,a.putImageData(e,0,0,0,0,e.width,e.height)};e.requestScreenshot(n,r)}}}function FitToWindowDirective(e,t){return{restrict:"C",priority:-1,link:function(i,n,o){function a(){var e,i,l,c=t.innerWidth/t.innerHeight;s?(l=n.find("IMG")[0],e=l&&l.height,i=l&&l.width):"VIDEO"===r.tagName?(e=r.videoHeight,i=r.videoWidth):"IMG"===r.tagName&&(e=r.height,i=r.width),e&&i&&(i/e>c?o.$addClass("fit-to-window-width-directive"):o.$removeClass("fit-to-window-width-directive"),s?n.find("IMG").off("load",a):n.off("load",a))}var r=n[0],s=o.ngBindHtml;s?i.$watch("ngBindHtml",function(){e(function(){n.find("IMG").on("load",a),a()},50)}):n.on("load",a),a(),angular.element(t).on("resize",_.debounce(a,150))}}}function VideoContainer(e){return{restrict:"A",link:function(t,i){function n(){var e;switch(r){case"html5":e=i.find("video")[0];break;case"vimeo":e=i.find("iframe")[0];break;case"youtube":e=i.find("iframe")[0]}return e}var o=i[0],a=(angular.element(o),t.slide),r="",s=!1;a.attributes.video?r="html5":a.annotation.content.indexOf("vimeo")>=0?r="vimeo":a.annotation.content.indexOf("youtube")>=0&&(r="youtube"),e.$on("videoEnter",function(e,t){t===a&&("html5"!==r||s||(n().play(),s=!0))}),e.$on("videoExit",function(e,t){if(t===a&&"html5"===r){var i=n();i.pause()}})}}}angular.module("shotbyshot",["ngAnimate","ngCookies","ngTouch","ngSanitize","ui.router"]).config(["$stateProvider","$urlRouterProvider","$sceDelegateProvider",function(e,t,i){e.state("shot",{url:"/:shot",templateUrl:"partials/shot.html",controller:"ShotCtrl",controllerAs:"shot"}),t.otherwise("/0001"),i.resourceUrlWhitelist(["self","https://worldrecordsjournal.org/wp/wp-content/uploads/**","https://s3.amazonaws.com/world-records-journal/**","https://s3.amazonaws.com/world-records-journal/","player.vimeo.com/video/**","http://cf.lossur.es/**","http://d16hdktz6rtx08.cloudfront.net/**"])}]),ShotCtrl.$inject=["$scope","$sce","$filter","$timeout","$state","ShotService","AnnotationParserService","ShotVideoService","ScrollService","AnalyticsService","AutoScrollerService"],angular.module("shotbyshot").controller("ShotCtrl",ShotCtrl),ShotService.$inject=["$rootScope","$http","$filter","$stateParams","$q","AnnotationsService"],angular.module("shotbyshot").service("ShotService",ShotService),AnnotationsService.$inject=["Annotation"],angular.module("shotbyshot").service("AnnotationsService",AnnotationsService),AnnotationParserService.$inject=["$sce","$rootScope","Annotation"],angular.module("shotbyshot").service("AnnotationParserService",AnnotationParserService),angular.module("shotbyshot").factory("Annotation",Annotation),angular.module("shotbyshot").service("StreetViewService",StreetViewService),VideoService.$inject=["ShotService"],angular.module("shotbyshot").service("VideoService",VideoService),angular.module("shotbyshot").service("ShotVideoService",ShotVideoService),ScrollService.$inject=["ShotVideoService"],angular.module("shotbyshot").service("ScrollService",ScrollService),angular.module("shotbyshot").service("AutoScrollerService",AutoScrollerService),AnalyticsService.$inject=["$window"],angular.module("shotbyshot").service("AnalyticsService",AnalyticsService),angular.module("shotbyshot").filter("shot",function(){return ShotFilter}),angular.module("shotbyshot").filter("mimetype",function(){return MimeTypeFilter}),angular.module("shotbyshot").filter("webm",function(){return WebMFilter}),SlideManager.$inject=["$timeout","ScrollService"],angular.module("shotbyshot").directive("slideManager",SlideManager),angular.module("shotbyshot").directive("slide",Slide),BackgroundCoverDirective.$inject=["$timeout","$window"],angular.module("shotbyshot").directive("backgroundCoverDirective",BackgroundCoverDirective),shotVideoDirective.$inject=["VideoService","ShotVideoService"],angular.module("shotbyshot").directive("shotVideoDirective",shotVideoDirective),StreetView.$inject=["StreetViewService"],angular.module("shotbyshot").directive("streetView",StreetView),VideoFrame.$inject=["VideoService"],angular.module("shotbyshot").directive("videoFrame",VideoFrame),FitToWindowDirective.$inject=["$timeout","$window"],angular.module("shotbyshot").directive("fitToWindowDirective",FitToWindowDirective),VideoContainer.$inject=["$rootScope"],angular.module("shotbyshot").directive("videoContainer",VideoContainer),function(e){try{e=angular.module("shotbyshot")}catch(t){e=angular.module("shotbyshot",[])}e.run(["$templateCache",function(e){e.put("partials/nav.html",'<nav class="top-nav" ng-class="{menu: menuIsOn && !globalIsOn, global: globalIsOn}"><button class="top-nav-menu-button" ng-click="toggleGlobalMenu()"></button><div class="top-nav-current-slide" ng-click="toggleMenu()"><div class="top-nav-author down" ng-repeat="slide in shot.slides | filter:isHeaderSlide">{{ slide.nav || slide.annotation.author.name }}</div><div class="top-nav-index-label">Volume Index</div><button class="top-nav-shots-button"></button></div><div class="top-nav-shot" ng-show="shot.id"><a ng-show="shot.previous" ui-sref="shot({ shot: shot.previous })" class="top-nav-shot-down"></a><div class="top-nav-shot-current">{{ shot.id }}</div><a ng-show="shot.next" ui-sref="shot({ shot: shot.next })" class="top-nav-shot-up"></a></div><div class="nav-menu"><div class="nav-menu-inner"><div class="nav-menu-details"><div class="nav-menu-appellation"><h1>All of our grievances are connected: An Interview with The Illuminator Collective</h1><h3>By Sherry Millner and Ernest Larsen</h3><div class="nav-menu-utilities"><a href="#">Download PDF</a> <a href="#">Share</a> <a href="#">Notes</a></div></div><div class="nav-menu-description"><p>Sherry Millner and Ernie Larsen are the anarchist co-creators of the interventionist video project State of Emergency, collaborating with more than 15 artists in a silent shout-out against U.S. invasions of the Middle East and the global plague of neo-liberal ideology. Together they have also produced several situation-ist films, including the new video, Partial Critique of Separation, two anti-documentaries redefining crime, and a series of semi-autobiographical videos focusing on the authoritarian structures indispensable to capital. Millner is also an installation artist and photomonteur; Larsen a novelist and media critic.</p><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed euismod rutrum eros vel gravida. Ut in volutpat lacus. Vivamus mollis sodales euismod. Phasellus dignissim imperdiet placerat. Sed eu semper nunc. Nam non pulvinar lectus, in aliquet metus. Quisque ultricies sodales ante. Donec euismod diam a semper posuere. Nulla facilisi. Phasellus sit amet ex a eros cursus porttitor at ac tellus. Curabitur lobortis egestas molestie.</p></div></div><div class="nav-menu-controls"><div class="nav-menu-tabs"><a class="nav-menu-tab" ng-repeat="tab in [\'shots\', \'tags\']" ng-click="$parent.showMenuTab = tab; $parent.filterShots();" ng-bind="tab" ng-class="{on: showMenuTab === tab}"></a></div></div><div class="nav-menu-shots" ng-show="showMenuTab === \'shots\'"><h4>Volume I: The Camera</h4><div class="nav-menu-scrollable"><a class="nav-menu-shot" ng-repeat="shot in thumbs" ui-sref="shot({ shot: shot.slug })" ng-style="{\'background-image\': \'url(\' + thumbnailForShot(shot) + \')\'}"><div class="nav-menu-shot-number">{{ shot.slug | number }}</div><div class="nav-menu-shot-details"><strong>All of our grievances are connected: An Interview with The Illuminator Collective</strong><p>By Sherry Millner and Ernest Larsen</p></div></a></div></div><div class="nav-menu-tags" ng-show="showMenuTab === \'tags\'"><div class="nav-menu-scrollable"><a class="nav-menu-tag" ng-repeat="tag in shot.tags" ng-bind-html="tag.title" ng-click="$parent.filterShots(tag); $parent.showMenuTab = \'shots\';"></a></div></div></div></div><div class="nav-global"><div><a href="#">About</a></div><div><a href="#">Volumes</a></div><div><a href="#">Subscribe</a></div><div><a href="#">Newsletter Signup</a></div><div><a href="#">Call for Submissions</a></div><div><a href="#">Contact</a></div><div class="copyright">© <strong>UnionDocs, Inc.</strong> 2014</div></div></nav><nav class="side-nav"><ul class="side-nav-circles"><li class="side-nav-circle" ng-repeat="slide in shot.slides | filter:isNavSlide" ng-click="scrollToSlide(slide)"><div class="side-nav-tag">{{ slide.nav || slide.annotation.author.name }}</div></li></ul></nav>')}])}(),function(e){try{e=angular.module("shotbyshot")}catch(t){e=angular.module("shotbyshot",[])}e.run(["$templateCache",function(e){e.put("partials/shot.html",'<div class="container"><div ng-class="{\'cinema\': shot.playing}" ng-include="\'partials/nav.html\'"></div><div class="content" ng-class="{\'shot-ready\': shot.ready, \'cinema\': shot.playing}"><div class="shot-background" ng-style="{\'opacity\': shot.backgroundOpacity}"></div><video class="shot-video-directive" crossorigin="" autoplay="" loop="" muted=""><source ng-src="{{ shot.videoUrl }}" type="video/mp4"><source ng-src="{{ shot.videoUrl | webm }}" type="video/webm">Your browser does not support the <code>video</code> element.</video><div class="shot-video-play" ng-show="shot.ready && inView && !shot.playing" ng-click="shot.play()"></div><div class="slides"><slide-manager slides="shot.slides"></slide-manager></div></div></div>')}])}();